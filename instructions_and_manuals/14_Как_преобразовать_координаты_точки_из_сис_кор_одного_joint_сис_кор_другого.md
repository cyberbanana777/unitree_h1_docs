# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–æ—á–∫–∏ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å—É—Å—Ç–∞–≤–æ–≤ —Ä–æ–±–æ—Ç–∞

## –í–≤–µ–¥–µ–Ω–∏–µ

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ ROS 2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ `tf2_echo`. –û–Ω–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (TF) –∏ –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ—Ç—Å—á—ë—Ç–∞ (—Ñ—Ä–µ–π–º–∞–º–∏).

**–í–∞–∂–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ:** –î–ª—è —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã —Ä–æ–±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è —Å–≤–æ–∏—Ö —Ñ—Ä–µ–π–º–æ–≤ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –º–µ–∂–¥—É –Ω–∏–º–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ç–æ–ø–∏–∫–µ, –∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–æ –Ω–∏–∂–µ.

## 1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ [unitree_h1_visualization_ws](https://github.com/cyberbanana777/unitree_h1_visualization_ws) –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `show.launch.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º) –¥–ª—è —Ä–æ–±–æ—Ç–∞ Unitree H1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–æ–∂–Ω–æ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–∏.

### –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

*   **–ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ Rviz** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è):
    ```bash
    ros2 launch completed_scripts_visualization show.launch.py mode:=without_hands launch_rviz:=True robot:=simulation
    ```

*   **–ó–∞–ø—É—Å–∫ –±–µ–∑ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
    ```bash
    ros2 launch completed_scripts_visualization show.launch.py mode:=without_hands robot:=simulation
    ```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ launch-—Ñ–∞–π–ª–∞

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã launch-—Ñ–∞–π–ª–∞ –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π: —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ä–æ–±–æ—Ç–æ–º, —Å–∏–º—É–ª—è—Ü–∏—è –∏ —Ç.–¥.), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
ros2 launch completed_scripts_visualization show.launch.py -s
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

–î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º launch-—Ñ–∞–π–ª–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –¥–≤–µ –Ω–æ–¥—ã: `robot_state_publisher`. 

`robot_state_publisher` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç URDF, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `robot_description`, –∏ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å—É—Å—Ç–∞–≤–æ–≤ –∏–∑ —Ç–æ–ø–∏–∫–∞ `joint_states` –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä—è–º–æ–π –∫–∏–Ω–µ–º–∞—Ç–∏–∫–∏ —Ä–æ–±–æ—Ç–∞ (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç) –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `tf`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ª—é–±–æ–≥–æ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

```bash
ros2 node list
```
–í —Å–ø–∏—Å–∫–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–∑–ª–æ–≤ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —É–∑–µ–ª —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `/robot_state_publisher`.

```bash
ros2 topic list
```
–í —Å–ø–∏—Å–∫–µ —Ç–æ–ø–∏–∫–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ø–∏–∫–∏ `/tf_static` –∏ `/tf`.

## 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã `tf2_echo`

### –§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:
```bash
ros2 run tf2_ros tf2_echo <–∏—Å—Ö–æ–¥–Ω—ã–π_—Ñ—Ä–µ–π–º> <—Ü–µ–ª–µ–≤–æ–π_—Ñ—Ä–µ–π–º>
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–∞–∑–∞ (`pelvis`) –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø—Ä–∞–≤–æ–≥–æ –ø–ª–µ—á–∞ (`right_shoulder_pitch_link`), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
ros2 run tf2_ros tf2_echo pelvis right_shoulder_pitch_link
```

### –ì–¥–µ –Ω–∞–π—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—Ä–µ–π–º–æ–≤?
*   –í –æ–∫–Ω–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ Rviz (–≤ —Ä–∞–∑–¥–µ–ª–µ TF)
*   –í URDF-–æ–ø–∏—Å–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏ —Ä–æ–±–æ—Ç–∞

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–∞—á–Ω—ë—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞:

```bash
At time 1761151063.357288585
- Translation: [0.005, -0.155, 0.430]
- Rotation: in Quaternion [-0.216, 0.000, 0.000, 0.976]
```

**–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

*   **Translation `[x, y, z]`** ‚Äî –≤–µ–∫—Ç–æ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (–≤ –º–µ—Ç—Ä–∞—Ö) –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–∞ –∫ —Ü–µ–ª–µ–≤–æ–º—É:
    *   **X = 0.005 –º**: –ü—Ä–∞–≤–æ–µ –ø–ª–µ—á–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ—á—Ç–∏ –ø—Ä—è–º–æ –ø–æ –æ—Å–∏ X –æ—Ç —Ç–∞–∑–∞ (—Å–ª–µ–≥–∫–∞ –≤–ø–µ—Ä–µ–¥–∏)
    *   **Y = -0.155 –º**: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –æ—Å–∏ Y –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–ª–µ—á–æ —Å–º–µ—â–µ–Ω–æ –≤–ª–µ–≤–æ –æ—Ç —Ç–∞–∑–∞ (–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ä–æ–±–æ—Ç–∞ –æ—Å—å Y –æ–±—ã—á–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–ª–µ–≤–æ)
    *   **Z = 0.430 –º**: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø–ª–µ—á–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ —Ç–∞–∑–∞

*   **Rotation `[x, y, z, w]`** ‚Äî –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –≤ –≤–∏–¥–µ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω–∞:
    *   –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `x` –∏ `w` —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø–æ–≤–æ—Ä–æ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –≤–æ–∫—Ä—É–≥ –æ—Å–∏ X

### –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Ñ—Ä–µ–π–º–∞–º–∏ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏ –º–µ–Ω—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –º–µ—Ä–µ –¥–≤–∏–∂–µ–Ω–∏—è –∑–≤–µ–Ω—å–µ–≤ —Ä–æ–±–æ—Ç–∞.

**–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–æ–±–æ—Ç–∞ (–∏–ª–∏ –µ–≥–æ —Å–∏–º—É–ª—è—Ü–∏–æ–Ω–Ω—É—é –º–æ–¥–µ–ª—å) –≤ –Ω—É–∂–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–π, –∏ —Ç–æ–ª—å–∫–æ –∑–∞—Ç–µ–º —Å–Ω–∏–º–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é `tf2_echo`.

## 3. –ú–∞—Ç—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

### –û–±—â–∞—è —Ñ–æ—Ä–º—É–ª–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

–§–æ—Ä–º—É–ª–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–æ—á–∫–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã 1 –≤ —Å–∏—Å—Ç–µ–º—É 2:

**P‚ÇÇ = R √ó P‚ÇÅ + t**

–≥–¥–µ:
- **P‚ÇÅ** = [x‚ÇÅ, y‚ÇÅ, z‚ÇÅ] - —Ç–æ—á–∫–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- **P‚ÇÇ** = [x‚ÇÇ, y‚ÇÇ, z‚ÇÇ] - —Ç–æ—á–∫–∞ –≤ —Ü–µ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç  
- **R** - –º–∞—Ç—Ä–∏—Ü–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ 3√ó3
- **t** = [t‚Çì, t·µß, t‚ÇÇ] - –≤–µ–∫—Ç–æ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

```
Translation: t = [0.005, -0.155, 0.430]
Rotation: q = [-0.216, 0.000, 0.000, 0.976]  # [x, y, z, w]
Point: P‚ÇÅ = [0.1, 0.2, 0.3]
```

### –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω–∞ –≤ –º–∞—Ç—Ä–∏—Ü—É –ø–æ–≤–æ—Ä–æ—Ç–∞

#### –§–æ—Ä–º—É–ª–∞ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω–∞:
q = [x, y, z, w] = [q‚Çì, q·µß, q_z, q_w]

#### –ú–∞—Ç—Ä–∏—Ü–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏–∑ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω–∞:

```
    [1-2(q·µß¬≤+q‚ÇÇ¬≤)   2(q‚Çìq·µß-q_wq‚ÇÇ)   2(q‚Çìq‚ÇÇ+q_wq·µß) ]
R = [2(q‚Çìq·µß+q_wq‚ÇÇ)   1-2(q‚Çì¬≤+q‚ÇÇ¬≤)   2(q·µßq‚ÇÇ-q_wq‚Çì) ]
    [2(q‚Çìq‚ÇÇ-q_wq·µß)   2(q·µßq‚ÇÇ+q_wq‚Çì)   1-2(q‚Çì¬≤+q·µß¬≤) ]
```

#### –†–∞—Å—á—ë—Ç –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞:
```
q‚Çì = -0.216, q·µß = 0.000, q‚ÇÇ = 0.000, q_w = 0.976

R = [1.000  0.000  0.000]
    [0.000  0.907  0.422]
    [0.000 -0.422  0.907]
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–æ—Ä–æ—Ç–∞

**P_rotated = R √ó P‚ÇÅ**

```
[1.000  0.000  0.000]   [0.1]   [0.1]
[0.000  0.907  0.422] √ó [0.2] = [0.907√ó0.2 + 0.422√ó0.3] = [0.1814 + 0.1266] = [0.308]
[0.000 -0.422  0.907]   [0.3]   [-0.422√ó0.2 + 0.907√ó0.3] = [-0.0844 + 0.2721] = [0.188]
```

**P_rotated = [0.1, 0.308, 0.188]**

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

**P‚ÇÇ = P_rotated + t**

```
P‚ÇÇ = [0.1, 0.308, 0.188] + [0.005, -0.155, 0.430]
P‚ÇÇ = [0.105, 0.153, 0.618]
```

## 4. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å –ø–æ–º–æ—â—å—é ROS2 –Ω–æ–¥—ã

### –ü–æ–ª–Ω—ã–π –∫–æ–¥ –Ω–æ–¥—ã

```python
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import PointStamped
from tf2_ros import Buffer, TransformListener
from tf2_geometry_msgs import do_transform_point

class RobustTFNode(Node):
    def __init__(self):
        super().__init__('robust_tf_node')
        self.tf_buffer = Buffer()
        self.tf_listener = TransformListener(self.tf_buffer, self)
        self.timer = self.create_timer(0.5, self.timer_callback)  # 2 Hz
        self.get_logger().info("Robust TF node started")

    def timer_callback(self):
        try:
            result = self.convert_point([0.1, 0.2, 0.3], 'pelvis', 'right_shoulder_pitch_link') # 'pelvis' - —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–∞–∑–∞ —Ä–æ–±–æ—Ç–∞, 'right_shoulder_pitch_link' - —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–ª–µ—á–∞–≤–æ–≥–æ —Å—É—Å—Ç–∞–≤–∞, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∂–µ–ª–∞–µ–º—ã–µ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
            if result:
                self.get_logger().info(f"Transform: {result}")
            else:
                self.get_logger().warning("TF not available yet, but still running...")
        except Exception as e:
            self.get_logger().error(f"Callback error: {e} - BUT CONTINUING!")

    def convert_point(self, point, source_frame, target_frame):
        try:
            if self.tf_buffer.can_transform(target_frame, source_frame, rclpy.time.Time(), timeout=rclpy.duration.Duration(seconds=1.0)):
                transform = self.tf_buffer.lookup_transform(target_frame, source_frame, rclpy.time.Time())
                point_msg = PointStamped()
                point_msg.header.frame_id = source_frame
                point_msg.point.x, point_msg.point.y, point_msg.point.z = point
                new_point = do_transform_point(point_msg, transform)
                return [new_point.point.x, new_point.point.y, new_point.point.z]
            return None
        except:
            return None

def main():
    rclpy.init()
    node = RobustTFNode()
    rclpy.spin(node)
    node.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

## –ü–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –Ω–æ–¥—ã

### **1. –ò–º–ø–æ—Ä—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```python
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import PointStamped
from tf2_ros import Buffer, TransformListener
from tf2_geometry_msgs import do_transform_point
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- `rclpy` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å ROS 2 –¥–ª—è Python
- `Node` - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ROS 2 –Ω–æ–¥
- `PointStamped` - —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–æ—á–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- `Buffer` –∏ `TransformListener` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TF (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏)
- `do_transform_point` - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ —Ç–æ—á–∫–µ

---

### **2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –Ω–æ–¥—ã**
```python
class RobustTFNode(Node):
    def __init__(self):
        super().__init__('robust_tf_node')
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `RobustTFNode` - –Ω–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å –Ω–æ–¥—ã, –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `Node`
- `super().__init__('robust_tf_node')` - –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ –∑–∞–¥–∞–µ—Ç –∏–º—è –Ω–æ–¥—ã
- –ò–º—è –Ω–æ–¥—ã `'robust_tf_node'` –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≤ ROS 2 —Å–∏—Å—Ç–µ–º–µ

---

### **3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TF —Å–∏—Å—Ç–µ–º—ã**
```python
self.tf_buffer = Buffer()
self.tf_listener = TransformListener(self.tf_buffer, self)
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `Buffer()` - —Å–æ–∑–¥–∞–µ—Ç –±—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π
- `TransformListener()` - —Å–ª—É—à–∞–µ—Ç —Ç–æ–ø–∏–∫–∏ TF –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –±—É—Ñ–µ—Ä
- üìä **–ê–Ω–∞–ª–æ–≥–∏—è**: –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —á—Ç–æ `Buffer` - —ç—Ç–æ –±–ª–æ–∫–Ω–æ—Ç, –∞ `TransformListener` - —Å–µ–∫—Ä–µ—Ç–∞—Ä—å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –Ω–µ–≥–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–æ–∂–µ–Ω–∏–π –æ–±—ä–µ–∫—Ç–æ–≤

---

### **4. –¢–∞–π–º–µ—Ä –∏ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å**
```python
self.timer = self.create_timer(0.5, self.timer_callback)  # 2 Hz
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `create_timer(0.5, callback)` - —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–π–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥
- **2 Hz** - 2 —Ä–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É
- `timer_callback` - —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ —Ç–∞–π–º–µ—Ä—É

---

### **5. –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª - timer_callback**
```python
def timer_callback(self):
    try:
        result = self.convert_point([0.1, 0.2, 0.3], 'pelvis', 'right_shoulder_pitch_link')
        if result:
            self.get_logger().info(f"Transform: {result}")
        else:
            self.get_logger().warning("TF not available yet, but still running...")
    except Exception as e:
        self.get_logger().error(f"Callback error: {e} - BUT CONTINUING!")
```

**–ü–æ—à–∞–≥–æ–≤–æ:**
1. **–ö–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥** –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è
2. **–ü—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å** —Ç–æ—á–∫—É `[0.1, 0.2, 0.3]` –∏–∑ —Å–∏—Å—Ç–µ–º—ã `pelvis` –≤ `right_shoulder_pitch_link`
3. **–ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ** - –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. **–ï—Å–ª–∏ –Ω–µ—Ç** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
5. **–ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ** - –ø–∏—à–µ—Ç –≤ –ª–æ–≥, –Ω–æ –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

---

### **6. –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**
```python
def convert_point(self, point, source_frame, target_frame):
    try:
        if self.tf_buffer.can_transform(target_frame, source_frame, rclpy.time.Time(), timeout=rclpy.duration.Duration(seconds=1.0)):
            transform = self.tf_buffer.lookup_transform(target_frame, source_frame, rclpy.time.Time())
            point_msg = PointStamped()
            point_msg.header.frame_id = source_frame
            point_msg.point.x, point_msg.point.y, point_msg.point.z = point
            new_point = do_transform_point(point_msg, transform)
            return [new_point.point.x, new_point.point.y, new_point.point.z]
        return None
    except:
        return None
```

**–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä:**

#### **–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**
```python
self.tf_buffer.can_transform(target_frame, source_frame, rclpy.time.Time(), timeout=1.0)
```
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç**: –ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∏–∑ `source_frame` –≤ `target_frame`?
- **timeout=1.0**: –ñ–¥–µ—Ç –¥–æ 1 —Å–µ–∫—É–Ω–¥—ã
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `True` –µ—Å–ª–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞, `False` –µ—Å–ª–∏ –Ω–µ—Ç

#### **–®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**
```python
transform = self.tf_buffer.lookup_transform(target_frame, source_frame, rclpy.time.Time())
```
- **–ü–æ–ª—É—á–∞–µ—Ç** –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- üìç **–í–∞–∂–Ω–æ –ø–æ—Ä—è–¥–æ–∫**: `target_frame`, `source_frame` - "–∫—É–¥–∞", "–æ—Ç–∫—É–¥–∞"

#### **–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**
```python
point_msg = PointStamped()
point_msg.header.frame_id = source_frame
point_msg.point.x, point_msg.point.y, point_msg.point.z = point
```
- `PointStamped()` - —Å–æ–∑–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "—Ç–æ—á–∫–∞ —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç"
- `header.frame_id` - —É–∫–∞–∑—ã–≤–∞–µ—Ç –≤ –∫–∞–∫–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–æ—á–∫–∞

#### **–®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**
```python
new_point = do_transform_point(point_msg, transform)
```
- **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç** —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∫ —Ç–æ—á–∫–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç** —Ç—É –∂–µ —Ç–æ—á–∫—É, –Ω–æ –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
   

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –Ω–æ–¥—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ ROS2 –ø–∞–∫–µ—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ ROS2 –ø–∞–∫–µ—Ç `simple_tf_demo` –≤ –ø–∞–ø–∫–µ `/src` –≤–∞—à–µ–π `_ws` –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —É–∂–µ –∞–ø–∫—É —É–∂–µ —Å—É—â–µ—Å–≤—Ç—É—é—â–µ–≥–æ –ø–∞–∫–µ—Ç–∞ `<–≤–∞—à_–ø–∞–∫–µ—Ç>/<–≤–∞—à_–ø–∞–∫–µ—Ç>`, —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `simple_tf_node.py`. 

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ ROS2 –ø–∞–∫–µ—Ç–∞ –∏ –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–º —É–∫–∞–∑–∞–Ω–∏–∏ [6_3_–ü—É–±–ª–∏–∫–∞—Ç–æ—Ä_–∏_–ø–æ–¥–ø–∏—Å—á–∏–∫](https://github.com/cyberbanana777/unitree_h1_docs/blob/main/instructions_and_manuals/6_3_–ü—É–±–ª–∏–∫–∞—Ç–æ—Ä_–∏_–ø–æ–¥–ø–∏—Å—á–∏–∫.md).

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–ª–∞ package.xml

–ü–æ—Å–ª–µ —Ç–µ–≥–∞ `<license></license>` –¥–æ–±–∞–≤—å—Ç–µ:

```xml
<depend>rclpy</depend>
<depend>geometry_msgs</depend>
<depend>tf2_ros</depend>
<depend>tf2_geometry_msgs</depend>
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–ª–∞ setup.py

–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –ø–∞–∫–µ—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `simple_tf_demo`, –∞ —Ñ–∞–π–ª - `simple_tf_node.py`):

```python
entry_points={
    'console_scripts': [
        'simple_tf_node = simple_tf_demo.simple_tf_node:main',
    ],
},
```

### 4. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
colcon build
source install/setup.bash
```

### 5. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏

```bash
# Terminal 1 - –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (—Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ rviz)
ros2 launch completed_scripts_visualization show.launch.py mode:=without_hands launch_rviz:=True robot:=simulation
```
```bash
# Terminal 2 - –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à—É –Ω–æ–¥—É
ros2 run simple_tf_demo simple_tf_node
```

## üîÑ **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –Ω–æ–¥—ã:**

```
[INFO] [1761251684.294985257] [continuous_tf_node]: Continuous TF node started - will keep running even with errors
[INFO] [1761251684.390243757] [continuous_tf_node]: [1] Transform OK: [0.0945, 0.3769926948296918, 0.032365578089181335]
[INFO] [1761251686.487127476] [continuous_tf_node]: [22] Transform OK: [0.0945, 0.3769926948296918, 0.032365578089181335]
[INFO] [1761251688.488670306] [continuous_tf_node]: [42] Transform OK: [0.0945, 0.3769926948296918, 0.032365578089181335]
[INFO] [1761251690.587000672] [continuous_tf_node]: [63] Transform OK: [0.0945, 0.3769926948296918, 0.032365578089181335]
^C[INFO] [1761251691.009605015] [continuous_tf_node]: Node stopped by user
```

**–ù–æ–¥–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ–≥–¥–∞**, –ø–æ–∫–∞ –≤—ã –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–µ –≤—Ä—É—á–Ω—É—é.